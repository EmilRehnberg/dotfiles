#!/usr/bin/env ruby
# Requires: mplayer, ttf-kochi-mincho package
# The later should be installed with the new-install script.

# script for running mplayer with japanese utf8 subs
require "pathname"
class Jmplayer
  EXECUTABLE = "mplayer"
  ENCODING = '-utf8'

  def self.run
    %x(#{EXECUTABLE} #{ENCODING} #{font_argument} #{sub_argument} "#{video_file_name}")
  end

  private

  def self.font_argument
    "-font '#{font_name}'"
  end

  def self.font_name
    case ENV["_system_name"]
    when "Ubuntu"
      "Kochi Mincho"
    when "OSX"
      "Yu Mincho"
    else
      abort("Could not find environment variable and hence do not know what font to use")
    end
  end

  def self.sub_argument
    "-sub #{sub_file}" if sub_file_exist?
  end

  def self.sub_file_exist?
    sub_file.exist?
  end

  def self.sub_file
    @sub_file ||= video_file_name.sub_ext(".ja.srt")
  end

  def self.video_file_name
    @video_file_name ||= Pathname.new(ARGV[0])
  end
end

if __FILE__ == $0
  Jmplayer.run
end
